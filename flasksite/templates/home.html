{% extends "layout.html" %}

{% block content %}


<style>

.positive{
	fill:blue;
}

</style>
	<div class="jumbo">
		<div id="welcome">
		<h2>fetching...</h2>
		</div>
		<div id = "members">
		<h2 id="total_member_count">CURRENT MEMBERS: {{formatted_data}}</h2>
		</div>

	<div id="chart">
  <p>Net New Members, Past 90 Days</p>
  <svg></svg>
	</div>

	<div id="chart2">
  <p>Gross New Members, Past 90 Days</p>
  <svg></svg>
	</div>

	<div id="chart3">
  <p>Gross Opted-Out Members, Past 90 Days</p>
  <svg></svg>
	</div>

	</div>



<script type="text/javascript">


var x = {{data2|safe}};
var x2 = {{data3|safe}};
var x3 = {{data4|safe}};
var x4 = {{data5|safe}};
var x5 = {{data6|safe}};

var coerceToInt = function(list) {

for (var i=0;i<list.length;i++) {

	list[i]['y']=+list[i].y;
	}
};

//console.log(x);

var master = [];

var inner = {key:'Net New Members', values:x, color: '#37006E'}

master.push(inner)

coerceToInt(master[0].values);

var master2 = [];

var inner2 = {key:'Mobile', values:x2, color: '#1A661A'}

var inner3 = {key:'Email', values:x3, color: '#00FF00'}



master2.push(inner2)
master2.push(inner3)


coerceToInt(master2[0].values);
coerceToInt(master2[1].values);

var master3 = [];

var inner4 = {key:'Mobile', values:x4, color: '#800000'}

var inner5 = {key:'Email', values:x5, color: '#FF3333'}



master3.push(inner4)
master3.push(inner5)

coerceToInt(master3[0].values);
coerceToInt(master3[1].values);

//console.log(master2);
var makeMyChart = function(svgname,data) {
nv.addGraph(function() {
    var chart = nv.models.multiBarChart()


      .transitionDuration(350)
      .reduceXTicks(true)   //If 'false', every single x-axis tick label will be rendered.
      .rotateLabels(0)      //Angle to rotate x-axis labels.
      .showControls(false)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
      .groupSpacing(0.1)
      .stacked(true)
          //Distance between each group of bars.
    ;


        chart.xAxis
        .tickFormat(function(d) {

          //console.log(d);


          date1 = new Date(d)

          date1.setTime( date1.getTime() + date1.getTimezoneOffset()*60*1000 );

          return d3.time.format('%x')(date1)
        });

    chart.yAxis
        .tickFormat(d3.format(',f'));

    d3.select(svgname)
        .datum(data)
        .call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
	});
};

makeMyChart('#chart svg',master);
makeMyChart('#chart2 svg',master2);
makeMyChart('#chart3 svg',master3);



</script>






{% endblock %}
